# Makefileä½¿ç”¨ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

Cmãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–‹ç™ºã‚’åŠ¹ç‡åŒ–ã™ã‚‹ãŸã‚ã®Makefileã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚
CMakeã‚³ãƒãƒ³ãƒ‰ã‚’è¦šãˆã‚‹å¿…è¦ãŒãªãã€ç°¡å˜ãªmakeã‚³ãƒãƒ³ãƒ‰ã§é–‹ç™ºã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

### ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
```bash
make help        # åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ã‚’è¡¨ç¤º
```

## ä¸»è¦ã‚³ãƒãƒ³ãƒ‰

### ğŸ”¨ ãƒ“ãƒ«ãƒ‰é–¢é€£

```bash
make build       # ãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ«ãƒ‰ï¼ˆé€šå¸¸ã®é–‹ç™ºç”¨ï¼‰
make release     # ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ï¼ˆæœ€é©åŒ–ã‚ã‚Šï¼‰
make clean       # ãƒ“ãƒ«ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤
make rebuild     # ã‚¯ãƒªãƒ¼ãƒ³å¾Œã«å†ãƒ“ãƒ«ãƒ‰
```

### ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
make test        # ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

# å€‹åˆ¥ãƒ†ã‚¹ãƒˆ
make test-unit   # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿
make test-lexer  # å­—å¥è§£æãƒ†ã‚¹ãƒˆ
make test-hir    # HIRå¤‰æ›ãƒ†ã‚¹ãƒˆ
make test-mir    # MIRå¤‰æ›ãƒ†ã‚¹ãƒˆ
make test-opt    # æœ€é©åŒ–ãƒ†ã‚¹ãƒˆ
```

### ğŸš€ ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œ

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«æŒ‡å®šã—ã¦å®Ÿè¡Œ
make run FILE=examples/basics/01_simple.cm

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
make run-debug FILE=examples/basics/02_hello.cm

# è©³ç´°è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰
make run-verbose FILE=examples/basics/03_variables.cm
```

### ğŸ“ ã‚µãƒ³ãƒ—ãƒ«å®Ÿè¡Œï¼ˆã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼‰

```bash
make run-hello       # Hello Worldã‚’å®Ÿè¡Œ
make run-variables   # å¤‰æ•°ã‚µãƒ³ãƒ—ãƒ«ã‚’å®Ÿè¡Œ
make run-format      # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ–‡å­—åˆ—ã‚µãƒ³ãƒ—ãƒ«ã‚’å®Ÿè¡Œ
make run-all-examples # ã™ã¹ã¦ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’é †ç•ªã«å®Ÿè¡Œ
```

### ğŸ”¬ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ†ã‚¹ãƒˆ

```bash
make test-compile-rust  # Rustå¤‰æ›æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ
make test-compile-ts    # TypeScriptå¤‰æ›æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ
make test-compile-wasm  # WASMç”Ÿæˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ
```

### ğŸ“Š è§£æãƒ»ãƒ‡ãƒãƒƒã‚°

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ã®è§£æçµæœã‚’è¡¨ç¤º
make check FILE=test.cm     # å‹ãƒã‚§ãƒƒã‚¯ã®ã¿
make ast FILE=test.cm       # ASTï¼ˆæŠ½è±¡æ§‹æ–‡æœ¨ï¼‰è¡¨ç¤º
make hir FILE=test.cm       # HIRï¼ˆé«˜ãƒ¬ãƒ™ãƒ«ä¸­é–“è¡¨ç¾ï¼‰è¡¨ç¤º
make mir FILE=test.cm       # MIRï¼ˆä¸­ãƒ¬ãƒ™ãƒ«ä¸­é–“è¡¨ç¾ï¼‰è¡¨ç¤º
make mir-opt FILE=test.cm   # æœ€é©åŒ–å¾Œã®MIRè¡¨ç¤º
```

### ğŸ¨ é–‹ç™ºãƒ„ãƒ¼ãƒ«

```bash
make format      # C++ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
make lint        # é™çš„è§£æï¼ˆclang-tidyï¼‰
make docs        # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
make serve-docs  # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§è¡¨ç¤º
```

### ğŸ³ Dockerç’°å¢ƒ

```bash
make docker-build  # Dockerç’°å¢ƒã§ãƒ“ãƒ«ãƒ‰
make docker-test   # Dockerç’°å¢ƒã§ãƒ†ã‚¹ãƒˆ
```

## å®Ÿç”¨ä¾‹

### æ–°æ©Ÿèƒ½ã‚’é–‹ç™ºã™ã‚‹å ´åˆ

```bash
# 1. ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†å¾Œã€ãƒ“ãƒ«ãƒ‰
make build

# 2. ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã§å‹•ä½œç¢ºèª
make run FILE=my_test.cm

# 3. ãƒ‡ãƒãƒƒã‚°ãŒå¿…è¦ãªå ´åˆ
make run-debug FILE=my_test.cm

# 4. AST/HIR/MIRã‚’ç¢ºèª
make ast FILE=my_test.cm
make hir FILE=my_test.cm

# 5. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
make test
```

### ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹å ´åˆ

```bash
# æœ€é©åŒ–ã®åŠ¹æœã‚’ç¢ºèª
make mir FILE=test.cm        # æœ€é©åŒ–å‰
make mir-opt FILE=test.cm    # æœ€é©åŒ–å¾Œ

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ
make bench                    # ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œ
```

### ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©æ©Ÿèƒ½ã‚’è©¦ã™å ´åˆ

```bash
# Rustã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’ãƒ†ã‚¹ãƒˆ
make test-compile-rust

# TypeScriptã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’ãƒ†ã‚¹ãƒˆ
make test-compile-ts
```

## ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

é–‹ç™ºåŠ¹ç‡ã‚’ä¸Šã’ã‚‹ãŸã‚ã€çŸ­ç¸®ã‚³ãƒãƒ³ãƒ‰ã‚‚ç”¨æ„ï¼š

```bash
make b   # make build ã¨åŒã˜
make t   # make test ã¨åŒã˜
make r   # make run ã¨åŒã˜ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½¿ç”¨ï¼‰
make c   # make clean ã¨åŒã˜
```

## Tips

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

`FILE` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’çœç•¥ã™ã‚‹ã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `examples/basics/01_simple.cm` ãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼š

```bash
make r   # examples/basics/01_simple.cm ã‚’å®Ÿè¡Œ
```

### ä¸¦åˆ—ãƒ“ãƒ«ãƒ‰

Ninjaã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€è‡ªå‹•çš„ã«ä¸¦åˆ—ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¾ã™ã€‚

### ã‚¨ãƒ©ãƒ¼æ™‚ã®è©³ç´°è¡¨ç¤º

ãƒ†ã‚¹ãƒˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€è©³ç´°ãŒè‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆ`--output-on-failure` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### "make: command not found" ã‚¨ãƒ©ãƒ¼

```bash
# macOS
brew install make

# Ubuntu/Debian
sudo apt-get install build-essential

# Fedora/RHEL
sudo dnf install make
```

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ

```bash
# ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰ã‚’è©¦ã™
make rebuild

# Dockerã‚’ä½¿ã†ï¼ˆç’°å¢ƒå·®åˆ†ã‚’æ’é™¤ï¼‰
make docker-build
```

## ã¾ã¨ã‚

ã“ã®Makefileã«ã‚ˆã‚Šã€Cmã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°ãŒç°¡å˜ã«ãªã‚Šã¾ã™ã€‚
`make help` ã§ã„ã¤ã§ã‚‚ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ã‚’ç¢ºèªã§ãã¾ã™ã€‚