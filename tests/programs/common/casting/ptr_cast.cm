// ポインタキャストのテスト
// void* から具体的な型へのキャストを検証

import std::mem::{malloc, free};

int main() {
    print("=== Pointer Cast Test ===\n");

    // Test 1: void* -> int*
    print("Test 1: void* -> int*\n");
    void* raw1 = malloc(sizeof(int));
    int* p1 = raw1 as int*;
    *p1 = 42;
    int v1 = *p1;
    if (v1 == 42) {
        print("  int cast: PASS\n");
    } else {
        print("  int cast: FAIL\n");
    }
    free(raw1);

    // Test 2: void* -> double*
    print("Test 2: void* -> double*\n");
    void* raw2 = malloc(sizeof(double));
    double* p2 = raw2 as double*;
    *p2 = 3.14;
    double v2 = *p2;
    if (v2 > 3.13 && v2 < 3.15) {
        print("  double cast: PASS\n");
    } else {
        print("  double cast: FAIL\n");
    }
    free(raw2);

    // Test 3: void* -> bool*
    print("Test 3: void* -> bool*\n");
    void* raw3 = malloc(sizeof(bool));
    bool* p3 = raw3 as bool*;
    *p3 = true;
    bool v3 = *p3;
    if (v3 == true) {
        print("  bool cast: PASS\n");
    } else {
        print("  bool cast: FAIL\n");
    }
    free(raw3);

    // Test 4: void* -> char*
    print("Test 4: void* -> char*\n");
    void* raw4 = malloc(sizeof(char));
    char* p4 = raw4 as char*;
    *p4 = 'A';
    char v4 = *p4;
    if (v4 == 'A') {
        print("  char cast: PASS\n");
    } else {
        print("  char cast: FAIL\n");
    }
    free(raw4);

    // Test 5: 複数回の確保と解放
    print("Test 5: Multiple allocations\n");
    void* a = malloc(sizeof(int));
    void* b = malloc(sizeof(int));
    int* pa = a as int*;
    int* pb = b as int*;
    *pa = 100;
    *pb = 200;
    int va = *pa;
    int vb = *pb;
    if (va == 100 && vb == 200) {
        print("  multiple: PASS\n");
    } else {
        print("  multiple: FAIL\n");
    }
    free(a);
    free(b);

    print("\nAll pointer cast tests completed!\n");
    return 0;
}
