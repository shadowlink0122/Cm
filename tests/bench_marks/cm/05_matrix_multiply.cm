// ベンチマーク5: 行列乗算（1D配列版 - SIMD最適化）
// 300x300の行列同士を乗算
// 1D配列を使用してSIMDベクトル化を有効にする

import std::io;

void matrix_multiply(int n) {
    // 1D配列として行列を格納（行優先）
    int[90000] a;  // 300x300
    int[90000] b;  // 300x300（転置済みとして使用）
    int[90000] c;  // 300x300

    // 行列初期化
    for (int i = 0; i < n; i++) {
        for (int j = 0; j < n; j++) {
            int idx = i * n + j;
            a[idx] = (i + j) % 100;
            b[idx] = (i - j + 100) % 100;  // B^T[j][i] = B[i][j]
            c[idx] = 0;
        }
    }

    // 行列乗算（キャッシュ効率的なIKJ順、1Dインデックス）
    // SIMD最適化: 内側ループが連続メモリアクセス
    for (int i = 0; i < n; i++) {
        for (int k = 0; k < n; k++) {
            int a_ik = a[i * n + k];
            int base_c = i * n;
            int base_b = k * n;
            for (int j = 0; j < n; j++) {
                c[base_c + j] = c[base_c + j] + a_ik * b[base_b + j];
            }
        }
    }

    // 結果の一部を表示（検証用）
    println("Result c[0][0] = {c[0]}");
    println("Result c[n-1][n-1] = {c[(n-1) * n + (n-1)]}");
}

int main() {
    int n = 300;
    println("Multiplying {n}x{n} matrices (1D array, SIMD optimized)...");

    matrix_multiply(n);

    println("Matrix multiplication completed");
    return 0;
}