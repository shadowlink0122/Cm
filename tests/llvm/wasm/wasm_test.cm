// WebAssembly向けテスト
#![target(wasm32)]

// WebAssembly エクスポート属性
[[wasm_export]]
int add(int a, int b) {
    return a + b;
}

[[wasm_export]]
int multiply(int a, int b) {
    return a * b;
}

[[wasm_export]]
int fibonacci(int n) {
    if (n <= 1) {
        return n;
    }
    return fibonacci(n - 1) + fibonacci(n - 2);
}

// メモリ操作テスト
[[wasm_export]]
void fill_array(int* array, int size, int value) {
    for (int i = 0; i < size; i = i + 1) {
        array[i] = value + i;
    }
}

[[wasm_export]]
int sum_array(int* array, int size) {
    int sum = 0;
    for (int i = 0; i < size; i = i + 1) {
        sum = sum + array[i];
    }
    return sum;
}

// 文字列操作
[[wasm_export]]
int string_length(const char* str) {
    int len = 0;
    while (str[len] != 0) {
        len = len + 1;
    }
    return len;
}

// 構造体テスト
struct Point {
    float x;
    float y;
};

[[wasm_export]]
float distance(Point p1, Point p2) {
    float dx = p2.x - p1.x;
    float dy = p2.y - p1.y;
    // 簡易版（sqrtなし）
    return dx * dx + dy * dy;
}

// メイン関数（WebAssemblyでは_startとしてエクスポート）
[[wasm_export("_start")]]
void main() {
    // 初期化処理
    // WebAssemblyの場合、通常JavaScriptから関数を直接呼び出す
}

// メモリ拡張テスト（WebAssembly特有）
[[wasm_import("env", "memory_grow")]]
extern int memory_grow(int pages);

[[wasm_export]]
int expand_memory(int pages) {
    return memory_grow(pages);
}