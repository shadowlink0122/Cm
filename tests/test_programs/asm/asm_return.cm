// テスト: asmを使った値の操作
// 注意: インタプリタではインラインアセンブリは実行されません

import std::io::println;

int addWithAsm(int a, int b) {
    int result = 0;
    // インタプリタでは実行されないが、LLVMバックエンドでは
    // レジスタ経由で加算を行う
    asm("mov {a}, %eax");
    asm("add {b}, %eax");
    asm("mov %eax, {result}");

    // インタプリタ用のフォールバック
    if (result == 0) {
        result = a + b;
    }
    return result;
}

int main() {
    int val = addWithAsm(3, 7);
    println("3 + 7 = {val}");

    // ビット演算のテスト
    int x = 0xFF;
    int y = 0;
    asm("mov {x}, %eax");
    asm("not %eax");
    asm("mov %eax, {y}");

    // インタプリタ用フォールバック
    if (y == 0) {
        y = ~x;
    }
    println("NOT 0xFF = {y}");

    return 0;
}
