// i,n制約テスト - macro/const定数の即値展開
import std::io::println;

macro int CONST_42 = 42;
macro int CONST_100 = 100;

int main() {
#ifdef __x86_64__
    println("=== i,n Constraint Test ===");

    // === i制約: macro定数 ===
    int result1 = 0;
    __asm__("movl ${i:CONST_42}, ${=r:result1}");

    if (result1 == 42) {
        println("i constraint with macro: PASS");
    } else {
        println("i constraint with macro: FAIL");
    }

    // === n制約: 別のmacro定数 ===
    int result2 = 0;
    __asm__("movl ${n:CONST_100}, ${=r:result2}");

    if (result2 == 100) {
        println("n constraint with macro: PASS");
    } else {
        println("n constraint with macro: FAIL");
    }

    // === const定数（関数ローカル） ===
    const int LOCAL_CONST = 77;
    int result3 = 0;
    __asm__("movl ${i:LOCAL_CONST}, ${=r:result3}");

    if (result3 == 77) {
        println("i constraint with local const: PASS");
    } else {
        println("i constraint with local const: FAIL");
    }

    println("=== All Tests Passed ===");
#else
    // ARM64版
    println("=== i,n Constraint Test ===");

    // === i制約: macro定数 ===
    int result1 = 0;
    __asm__("mov ${=r:result1}, ${i:CONST_42}");

    if (result1 == 42) {
        println("i constraint with macro: PASS");
    } else {
        println("i constraint with macro: FAIL");
    }

    // === n制約: 別のmacro定数 ===
    int result2 = 0;
    __asm__("mov ${=r:result2}, ${n:CONST_100}");

    if (result2 == 100) {
        println("n constraint with macro: PASS");
    } else {
        println("n constraint with macro: FAIL");
    }

    // === const定数（関数ローカル） ===
    const int LOCAL_CONST = 77;
    int result3 = 0;
    __asm__("mov ${=r:result3}, ${i:LOCAL_CONST}");

    if (result3 == 77) {
        println("i constraint with local const: PASS");
    } else {
        println("i constraint with local const: FAIL");
    }

    println("=== All Tests Passed ===");
#end
    return 0;
}
