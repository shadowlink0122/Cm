// must {} ブロック構文テスト
// mustブロック内のコードはデッドコード最適化禁止

import std::io::println;

int main() {
#ifdef __x86_64__
    println("=== must {} Block Test ===");

    // 基本的なmustブロック（asmなし）
    int x = 0;
    must {
        x = 10;
        x = 20;
    }
    if (x == 20) {
        println("must block basic: PASS");
    } else {
        println("must block basic: FAIL");
    }

    // asmはmustブロック外で実行
    must {
        __asm__("nop");
        println("asm inside must: PASS");
    }

    println("=== All Tests Passed ===");
#else
    // ARM64版（nopは共通命令）
    println("=== must {} Block Test ===");

    int x = 0;
    must {
        x = 10;
        x = 20;
    }
    if (x == 20) {
        println("must block basic: PASS");
    } else {
        println("must block basic: FAIL");
    }

    must {
        __asm__("nop");
        println("asm inside must: PASS");
    }

    println("=== All Tests Passed ===");
#end
    return 0;
}
