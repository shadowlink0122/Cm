// tests/test_programs/asm/asm_bitwise.cm
// ビット操作命令のテスト

import std::io::println;

int main() {
    int a = 0xFF;
    int b = 0x0F;
    int shift_count = 2;

    // 論理演算
    asm("and {a}, {b}");
    println("asm: and instruction");

    asm("or {a}, {b}");
    println("asm: or instruction");

    asm("xor {a}, {b}");
    println("asm: xor instruction");

    asm("not %rax");
    println("asm: not instruction");

    // シフト命令
    asm("shl {shift_count}, %rax");
    println("asm: shl (shift left)");

    asm("shr {shift_count}, %rbx");
    println("asm: shr (shift right)");

    asm("sal $3, %rcx");
    println("asm: sal (shift arithmetic left)");

    asm("sar $2, %rdx");
    println("asm: sar (shift arithmetic right)");

    // ローテート命令
    asm("rol $4, %rsi");
    println("asm: rol (rotate left)");

    asm("ror $4, %rdi");
    println("asm: ror (rotate right)");

    // ビットテスト命令
    asm("bt $5, %rax");
    println("asm: bt (bit test)");

    asm("bts $3, %rbx");
    println("asm: bts (bit test and set)");

    asm("btr $2, %rcx");
    println("asm: btr (bit test and reset)");

    asm("btc $1, %rdx");
    println("asm: btc (bit test and complement)");

    return 0;
}