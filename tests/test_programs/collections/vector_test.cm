// Vector テスト - ローカル実装（インポートエラー回避）
import std::io::println;

use libc {
    void* malloc(long size);
    void free(void* ptr);
}

struct Vector {
    int* data;
    int size;
    int cap;
}

int main() {
    println("=== Vector Test ===");

    // 構造体リテラルで初期化
    Vector v = Vector { data: 0 as int*, size: 0, cap: 0 };
    println("Created: size={v.size}");

    // push 3回
    // --- push 10 ---
    {
        if (v.size >= v.cap) {
            v.data = malloc(32 as long) as int*;
            v.cap = 4;
        }
        int s = v.size;
        v.data[s] = 10;
        v.size = s + 1;
    }
    // --- push 20 ---
    {
        int s = v.size;
        v.data[s] = 20;
        v.size = s + 1;
    }
    // --- push 30 ---
    {
        int s = v.size;
        v.data[s] = 30;
        v.size = s + 1;
    }
    
    println("After push: len={v.size}");

    // 取得
    println("Elements:");
    println("  [0]: {v.data[0]}");
    println("  [1]: {v.data[1]}");
    println("  [2]: {v.data[2]}");

    // 設定
    v.data[1] = 200;
    println("After set(1, 200): [1]={v.data[1]}");

    // pop
    int sz = v.size;
    v.size = sz - 1;
    int last = v.data[v.size];
    println("pop: {last}, len={v.size}");

    // 解放
    free(v.data as void*);
    println("Freed");

    println("=== PASS ===");
    return 0;
}
