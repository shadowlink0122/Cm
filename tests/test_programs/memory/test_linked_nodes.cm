// テスト: ポinterフィールドを持つ構造体の連結

import std::io::println;

use libc {
    void* malloc(ulong size);
    void free(void* ptr);
}

struct Node {
    int value;
    Node* next;
}

int main() {
    println("=== Linked Node Test ===");
    
    // ノード1を確保
    println("Step 1: Creating node1...");
    void* mem1 = malloc(sizeof(Node));
    Node* node1 = mem1 as Node*;
    node1->value = 10;
    node1->next = null as Node*;
    
    // ノード2を確保
    println("Step 2: Creating node2...");
    void* mem2 = malloc(sizeof(Node));
    Node* node2 = mem2 as Node*;
    node2->value = 20;
    node2->next = null as Node*;
    
    // node1 -> node2 にリンク
    println("Step 3: Linking node1 -> node2...");
    node1->next = node2;
    
    // 値を読み取り
    println("Step 4: Reading values...");
    int v1 = node1->value;
    println("node1->value: {v1}");
    
    // nextを辿る
    println("Step 5: Following next pointer...");
    Node* next = node1->next;
    
    // nullチェック
    println("Step 6: Checking if next is valid...");
    if (next != null) {
        int v2 = next->value;
        println("next->value: {v2}");
    } else {
        println("next is null!");
    }
    
    // 解放
    println("Step 7: Freeing memory...");
    free(node2 as void*);
    free(node1 as void*);
    
    println("=== Done ===");
    return 0;
}
