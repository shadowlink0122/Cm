// thread_basic.cm - 基本的なスレッドテスト
import std::thread::spawn;
import std::thread::join;
import std::thread::sleep_ms;

// スレッドで実行する関数
void* worker(void* arg) {
    println("Worker thread started");
    sleep_ms(10);
    println("Worker thread finished");
    return 42 as void*;
}

int main() {
    println("Main thread starting worker");
    
    // スレッドを生成（関数ポインタをvoid*にキャスト）
    ulong t = spawn(worker as void*);
    
    println("Main thread waiting for worker");
    
    // スレッドの終了を待機
    int result = join(t);
    
    print("Worker returned: ");
    println(result);
    println("Main thread done");
    
    return 0;
}
