// test_generic_struct_field.cm - 構造体フィールド内のジェネリック型Tが構造体の場合のテスト
// 最小限のテストケース

import std::io::println;

use libc {
    void* malloc(ulong size);
    void free(void* ptr);
}

// テスト用の構造体
struct Item {
    int value;
}

// ジェネリックノード
struct Node<T> {
    T data;
}

// シンプルなジェネリック関数 - T dataフィールドを読み取る
<T> T get_data(Node<T>* node) {
    return node->data;
}

// シンプルなジェネリック関数 - T dataフィールドに書き込む
<T> void set_data(Node<T>* node, T data) {
    node->data = data;
}

int main() {
    println("=== Generic Struct Field Test ===");

    // Node<Item> を作成
    void* mem = malloc(sizeof(Node<Item>));
    Node<Item>* node = mem as Node<Item>*;

    // Item構造体を作成してセット
    Item item = {value: 42};
    set_data(node, item);

    // 読み取り
    Item got = get_data(node);
    int v = got.value;
    println("got.value = {v}");

    free(node as void*);

    println("=== Done ===");
    return 0;
}
