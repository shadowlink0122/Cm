// バッファリングI/Oテスト
import std::io::println;
import std::io::file::io::{read_file, write_file};

int main() {
    println("=== Buffered I/O Test ===");

    // テストフォルダ内のデータファイルを使用
    string data_path = "tests/test_programs/io/data/buffered_io_data.txt";

    // 1. 複数行のコンテンツを書き込み
    string content = "Line 1\nLine 2\nLine 3\n";
    bool ok = write_file(data_path, content);
    if (!ok) {
        println("Write failed");
        return 1;
    }
    println("Written");

    // 2. 読み込み
    string read_content = read_file(data_path);
    println("Read content");

    // 3. 行カウント
    int line_count = 0;
    for (int i = 0; i < read_content.len() as int; i++) {
        if (read_content[i] == '\n') {
            line_count = line_count + 1;
        }
    }
    println("Found {line_count} lines");

    // 4. 検証
    if (line_count == 3) {
        println("=== All Tests Passed ===");
        return 0;
    } else {
        println("Test failed");
        return 1;
    }
}
