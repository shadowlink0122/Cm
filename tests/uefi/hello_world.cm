// UEFI Hello World - ライブラリ使用版
// uefi::text を使用してインラインASM不要でテキスト出力
//
// ビルド手順:
//   make         (コンパイル＆リンク)
//   make run     (QEMUで実行)

import uefi::table::*;
import uefi::text::*;
import uefi::types::*;

// UEFIエントリポイント
ulong efi_main(EfiHandle image_handle, EfiSystemTable* system_table) {
    // 画面クリア
    uefi_clear_screen(system_table);

    // テキスト色を緑に設定
    uefi_set_color(system_table, EFI_GREEN);

    // メッセージ出力（ライブラリにより ASCII→UCS-2 変換が自動で行われる）
    uefi_println(system_table, "=========================");
    uefi_println(system_table, "  Hello from Cm (UEFI)!");
    uefi_println(system_table, "=========================");

    // 白に戻す
    uefi_set_color(system_table, EFI_WHITE);
    uefi_println(system_table, "");
    uefi_println(system_table, "UEFI Library Test:");
    uefi_println(system_table, "  - uefi::text OK");
    uefi_println(system_table, "  - uefi::types OK");
    uefi_println(system_table, "  - uefi::table OK");

    // HLTループ（ビジーウェイト回避）
    while (true) {
        __asm__("hlt");
    }

    return 0;
}
