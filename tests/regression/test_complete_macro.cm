// 完全なマクロシステムテスト

// Cm言語ネイティブマクロ（#macro使用）
#macro void LOG(string msg) {
    println(msg);
}

// ブロックを受け取るマクロ
#macro void WITH_LOCK(mutex& m, block code) {
    m.lock();
    code;
    m.unlock();
}

// 自動トレイト実装（withキーワード使用）
struct Point with Debug, Clone {
    int x;
    int y;
}

// テスト関数（#testディレクティブ）
#test void test_point() {
    Point p = {10, 20};
    assert(p.x == 10);
    assert(p.y == 20);
}

// ベンチマーク関数（#benchディレクティブ）
#bench void benchmark_loop() {
    int sum = 0;
    for (int i = 0; i < 1000000; i++) {
        sum += i;
    }
}

// 廃止予定関数（#deprecatedディレクティブ）
#deprecated("Use new_api() instead")
void old_api() {
    println("This is deprecated");
}

// インライン指示（#inlineディレクティブ）
#inline(always)
int fast_add(int a, int b) {
    return a + b;
}

// 最適化レベル指定（#optimizeディレクティブ）
#optimize(none)
void debug_function() {
    println("Debug only");
}

// constexpr関数
constexpr int BUFFER_SIZE = 1024;

constexpr int factorial(int n) {
    return (n <= 1) ? 1 : n * factorial(n - 1);
}

// テンプレート関数
template<typename T>
T max(T a, T b) {
    return (a > b) ? a : b;
}

int main() {
    // マクロ使用
    LOG("Starting program");

    // constexpr使用
    int buffer[BUFFER_SIZE];
    constexpr int fact5 = factorial(5);

    // テンプレート使用
    int max_int = max(10, 20);
    double max_double = max(3.14, 2.71);

    // 構造体使用
    Point p = {100, 200};

    return 0;
}