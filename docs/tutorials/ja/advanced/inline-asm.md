---
title: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¢ã‚»ãƒ³ãƒ–ãƒª
parent: Advanced
---

# ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¢ã‚»ãƒ³ãƒ–ãƒª

**å­¦ç¿’ç›®æ¨™:** `__asm__` ã‚’ä½¿ã£ã¦Cmå†…éƒ¨ã‹ã‚‰ã‚¢ã‚»ãƒ³ãƒ–ãƒªå‘½ä»¤ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚  
**æ‰€è¦æ™‚é–“:** 20åˆ†  
**é›£æ˜“åº¦:** ğŸ”´ ä¸Šç´š

> **å¯¾å¿œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰:** Native (LLVM) ã®ã¿

---

## åŸºæœ¬æ§‹æ–‡

```cm
__asm__("å‘½ä»¤");
```

### NOPï¼ˆä½•ã‚‚ã—ãªã„å‘½ä»¤ï¼‰

```cm
__asm__("nop");
```

### ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒãƒªã‚¢

```cm
// ãƒ¡ãƒ¢ãƒªæ“ä½œã®ä¸¦ã³æ›¿ãˆã‚’é˜²æ­¢
__asm__("" ::: "memory");
```

---

## ã‚ªãƒšãƒ©ãƒ³ãƒ‰åˆ¶ç´„

Cmç‹¬è‡ªã®æ§‹æ–‡ã§å¤‰æ•°ã¨ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’ç´ä»˜ã‘ã¾ã™ã€‚

### èª­ã¿æ›¸ãã‚ªãƒšãƒ©ãƒ³ãƒ‰ `${+r:å¤‰æ•°å}`

```cm
int x = 90;
__asm__("addl $$10, ${+r:x}");  // x86_64: x += 10 â†’ x = 100
```

`+r` ã¯ã€Œèª­ã¿æ›¸ãå¯èƒ½ãªãƒ¬ã‚¸ã‚¹ã‚¿ã€ã‚’æ„å‘³ã—ã¾ã™ã€‚

### è¤‡æ•°ã‚ªãƒšãƒ©ãƒ³ãƒ‰ã®ä½¿ç”¨

```cm
int val = 12345;
__asm__("xorl ${+r:val}, ${+r:val}");  // x86_64: val = 0
```

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ†å²

`#ifdef` ã¨çµ„ã¿åˆã‚ã›ã¦ã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ã®ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```cm
int result = 10;

#ifdef __x86_64__
    // x86_64: addå‘½ä»¤
    __asm__("addl $$5, ${+r:result}");
#endif

#ifdef __ARM64__
    // ARM64: addå‘½ä»¤
    __asm__("add ${+r:result}, ${+r:result}, #5");
#endif

println(result);  // 15
```

---

## å®Ÿç”¨ä¾‹

### ç®—è¡“æ¼”ç®— (x86_64)

```cm
int val = 10;
__asm__("addl $$5, ${+r:val}");    // åŠ ç®—: 15
__asm__("sall $$1, ${+r:val}");    // å·¦ã‚·ãƒ•ãƒˆ: 30
__asm__("subl $$10, ${+r:val}");   // æ¸›ç®—: 20
__asm__("negl ${+r:val}");         // ç¬¦å·åè»¢: -20
```

### ç®—è¡“æ¼”ç®— (ARM64)

```cm
int val = 10;
__asm__("add ${+r:val}, ${+r:val}, #5");    // åŠ ç®—: 15
__asm__("lsl ${+r:val}, ${+r:val}, #1");    // å·¦ã‚·ãƒ•ãƒˆ: 30
__asm__("sub ${+r:val}, ${+r:val}, #10");   // æ¸›ç®—: 20
__asm__("neg ${+r:val}, ${+r:val}");        // ç¬¦å·åè»¢: -20
```

### ãƒ“ãƒƒãƒˆæ¼”ç®—

```cm
int bits = 0xF0;

#ifdef __x86_64__
    __asm__("orl $$0x0F, ${+r:bits}");     // OR: 0xFF (255)
    __asm__("shll $$4, ${+r:bits}");       // å·¦ã‚·ãƒ•ãƒˆ
#endif
#ifdef __ARM64__
    __asm__("orr ${+r:bits}, ${+r:bits}, #0x0F");  // OR: 0xFF
    __asm__("lsl ${+r:bits}, ${+r:bits}, #4");      // å·¦ã‚·ãƒ•ãƒˆ
#endif
```

### ãƒ¡ãƒ¢ãƒªãƒãƒªã‚¢

```cm
#ifdef __x86_64__
    __asm__("mfence" ::: "memory");
#endif
#ifdef __ARM64__
    __asm__("dmb sy" ::: "memory");
#endif
```

---

## å³å€¤ã®è¨˜æ³•

| ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ | å³å€¤è¡¨è¨˜ | ä¾‹ |
|--------------|---------|-----|
| x86_64 | `$$å€¤` | `addl $$10, ${+r:x}` |
| ARM64 | `#å€¤` | `add ${+r:x}, ${+r:x}, #10` |

---

## æ³¨æ„äº‹é …

- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¢ã‚»ãƒ³ãƒ–ãƒªã¯ **LLVM ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰** ã§ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™
- `#ifdef` ã§ **å¿…ãšã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’åˆ†å²** ã—ã¦ãã ã•ã„
- ä¸æ­£ãªå‘½ä»¤ã¯LLVMã®ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªç®‡æ‰€ã§ã®ã¿ä½¿ç”¨ã‚’æ¨å¥¨ã—ã¾ã™

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- [externå®£è¨€](extern.html) â€” C/C++é–¢æ•°ã®å‘¼ã³å‡ºã—
- [FFI](ffi.html) â€” use libc / æ§‹é€ ä½“ã®å—ã‘æ¸¡ã—
- [ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µ](../compiler/preprocessor.html) â€” `#ifdef`/`#ifndef`/`#end`

---

**æœ€çµ‚æ›´æ–°:** 2026-02-08
