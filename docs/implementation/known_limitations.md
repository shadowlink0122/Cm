[English](known_limitations.en.html)

# Cm コンパイラ 既知の制限事項
## 2025年1月

### 1. 制御フロー

#### `else if` 構文
**状態**: 未対応
**問題**: elseブロック内のif文（`else if`パターン）が正しく実行されない
```cm
// 動作しない例
if (x < 10) {
    println(1);
} else if (x == 10) {  // このブロックが実行されない
    println(2);
}
```
**回避策**: ネストされたif-elseを使用
```cm
// 回避策
if (x < 10) {
    println(1);
} else {
    if (x == 10) {  // これも動作しない
        println(2);
    }
}
// 完全な回避策: 独立したif文を使用
if (x < 10) {
    println(1);
}
if (x >= 10 && x == 10) {
    println(2);
}
```

### 2. 文字列操作

#### 文字列連結
**状態**: 未実装
**問題**: 文字列と他の型の連結演算子（+）が未実装
```cm
// 動作しない例
println("Value: " + 42);
println("i = " + i);
```
**回避策**: フォーマット文字列を使用（部分的にサポート）
```cm
// 回避策
println("Value: {}", 42);  // 基本的なフォーマットは動作
```

### 3. 関数

#### 再帰関数
**状態**: 未対応
**問題**: 再帰関数呼び出しが無限ループまたはハングする

#### ネストされた関数呼び出し
**状態**: 部分的対応
**問題**: 複雑なネストされた関数呼び出しが正しく処理されない場合がある

### 4. 型システム

#### typedef
**状態**: 未実装
**問題**: 型エイリアスの定義がサポートされていない

#### 構造体
**状態**: 部分的対応
**問題**: 構造体の定義は可能だが、フィールドアクセスが完全に実装されていない

#### 配列
**状態**: 未実装
**問題**: 配列型および配列操作が未実装

### 5. その他

#### Switch文
**状態**: 部分的対応
**問題**: 基本的な動作はするが、一部のケースで出力が正しくない

## テスト結果サマリー
（2025年1月13日時点）

| カテゴリ | 成功率 | 備考 |
|---------|--------|------|
| basic | 93.3% (14/15) | return.cmは意図的なエラー |
| control_flow | 20% (2/10)* | else ifと文字列連結の問題で多くが失敗 |
| formatting | 100% (3/3) | 基本的なフォーマットは動作 |
| functions | - | 再帰・ネスト呼び出しに問題 |
| types | - | 多くの型機能が未実装 |

*注: 制御フロー自体は動作するが、出力の文字列連結が失敗するため、テストが失敗と判定される

## 推奨事項

1. **プロダクション使用は推奨しない** - 多くの基本機能が未実装または不完全
2. **単純な制御フロー** - if、for、whileの基本的な使用は可能
3. **数値出力** - 文字列連結を避け、数値を直接出力する
4. **フラットな関数** - 再帰やネストを避ける

## 今後の優先事項

1. `else if`のサポート（MIRローダリングの改善が必要）
2. 文字列連結演算子の実装
3. 完全な構造体サポート
4. 配列の実装
5. typedef サポート