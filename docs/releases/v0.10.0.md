# Cm v0.10.0 Release Notes (In Progress)

**リリース日**: 2024年12月（予定）

## 概要

v0.10.0では、モジュールシステムとインラインアセンブリのサポートを導入しました。これにより、プロジェクトの分割と低レベルアクセスが可能になります。

## 🎯 主要機能

### モジュールシステム (Phase 1-2完了)

Cm言語にC++風のモジュールシステムが導入されました。

#### 実装済み
- ✅ **import/export構文**: モジュールのインポートとエクスポート
- ✅ **ModuleLoader**: 自動的にモジュールファイルを検索・パース
- ✅ **標準ライブラリ**: `std/math`, `std/io`, `std/asm`
- ✅ **テストケース**: 基本的なモジュール機能のテスト

#### 構文

```cm
// 基本インポート
import std::math::basic;
int x = basic::abs(-5);

// 選択的インポート
import std::io::print { println, print_int };
println();

// エイリアス
import std::collections::vector as vec;

// エクスポート
export int add(int a, int b) {
    return a + b;
}
```

#### モジュール検索

1. **標準ライブラリ** (`std/`) - 最優先
2. **ソースと同じディレクトリ**
3. **親ディレクトリ**

パス変換例:
- `std::math::basic` → `std/math/basic.cm`

### インラインアセンブリ (Preview)

低レベルアクセスのためのインラインアセンブリをサポート。

```cm
// 基本使用
asm("nop");

// std::asmモジュール経由
import std::asm::inline;
int result = inline::nop();
```

## 📦 標準ライブラリ

### std/math/basic.cm
- `abs(int)` - 絶対値
- `max(int, int)` - 最大値
- `min(int, int)` - 最小値
- `square(int)` - 二乗
- `add(int, int)` - 加算

### std/io/print.cm
- `print_int(int)` - 整数出力
- `print_str(string)` - 文字列出力
- `println()` - 改行
- `println_int(int)` - 整数出力+改行

### std/asm/inline.cm
- `nop()` - NOP命令
- `get_rax()` - RAXレジスタ取得
- `set_rax(int)` - RAXレジスタ設定
- `get_rsp()` - スタックポインタ取得

## 🧪 テスト

新しいテストディレクトリ構造:
```
tests/test_programs/
├── modules/           # モジュールシステムテスト
│   ├── basic_import.cm
│   ├── selective_import.cm
│   ├── alias_import.cm
│   ├── custom_module.cm
│   ├── asm_test.cm
│   └── mymath.cm
├── arrays/
├── generics/
├── interface/
└── ...
```

## 🔧 実装の詳細

### ModuleLoader

**ファイル**: `src/frontend/module/module_loader.{hpp,cpp}`

```cpp
class ModuleLoader {
    std::optional<LoadedModule*> load_module(const ast::ModulePath&);
    bool is_loaded(const std::string& module_name);
};
```

### AST拡張

- `ImportDecl`: import宣言
- `ExportDecl`: export宣言
- `ModulePath`: モジュールパス
- `AsmStmt`: インラインアセンブリ文

## 🚧 進行中 (Phase 3以降)

### 未実装機能
- TypeCheckerとの統合
- HIR/MIR loweringでのモジュール処理
- Interpreterでの実行サポート
- LLVMバックエンドでのリンク

### 制限事項
- モジュールの入れ子は未サポート
- 循環依存の検出なし
- プライベートインポートのみ
- インラインアセンブリはx86_64のみ

## 📚 ドキュメント

- `docs/design/module_system.md` - モジュールシステム設計
- `ROADMAP.md` - v0.10.0の進捗

## 🎯 次のステップ

1. **Symbol Resolution** - TypeChecker統合
2. **HIR/MIR統合** - モジュール処理
3. **Interpreter** - 実行サポート
4. **LLVM Backend** - リンクとコンパイル

---

**注**: v0.10.0は開発中です。このリリースノートは進捗に応じて更新されます。
