# 包括的コード品質監査

## 1. TODO/FIXME項目（22件）

| ファイル | 行 | 内容 |
|---------|-----|------|
| parser_module.cpp | 614,630,639,648,668 | constexpr/template対応 |
| decl.hpp | 349 | パーサー更新時に修正 |
| types.hpp | 171 | 構造体サイズ計算 |
| js_minifier.cpp | 256 | より高度なインライン化 |
| intrinsics.hpp | 181,325 | atomic操作、自動生成 |
| codegen.hpp | 253 | インポート処理のLLVM最適化 |
| vectorizer.cpp | 197,216,248 | ベクトル化の完全実装 |
| source_location.hpp | 280 | より正確な実装 |
| dce.hpp | 330 | より詳細な副作用解析 |
| folding.hpp | 340 | 浮動小数点演算 |
| stmt.cpp | 85 | 構造体のサイズ計算 |
| expr_call.cpp | 315,1702 | 式パーサー、エラー報告 |
| lowering.hpp | 1329,1368 | ハッシュ関数 |

---

## 2. マジックナンバー

| ファイル | 値 | 用途 |
|---------|-----|------|
| parser.hpp | 10000, 1000 | トークン制限 |
| loop_detector.hpp | 100000, 10000 | ループ検出制限 |
| safe_codegen.hpp | 100, 1024, 5000, 10000, 1000000 | 安全制限 |
| pass_limiter.hpp | 100, 1000 | パス制限 |

→ **定数化を推奨**

---

## 3. 大きなファイル（リファクタリング候補）

| ファイル | 行数 | 備考 |
|---------|------|------|
| expr_call.cpp | 2217 | 関数呼び出し処理 |
| mir_to_llvm.cpp | 2143 | LLVM変換 |
| import.cpp | 2093 | インポート処理 |
| js/codegen.cpp | 1851 | JS生成 |
| hir/expr.cpp | 1833 | HIR式変換 |

---

## 4. コメントアウトされたデバッグコード

| ファイル | 内容 |
|---------|------|
| llvm/core/types.cpp | debug_msg呼び出し |
| mir_to_llvm.cpp | debug_msg呼び出し |

→ 削除または条件付きコンパイルへ

---

## 5. DRY違反（修正済み）

| 項目 | 状態 |
|------|------|
| インクリメントconst check | ✅ |
| 代入/インクリメントborrow check | ✅ |
| mark_variable_modified | ✅ |

---

## 6. 推奨アクション

| 優先度 | アクション |
|--------|-----------|
| 🟠 中 | マジックナンバーを定数化 |
| 🟡 低 | TODO項目の整理（不要なら削除） |
| 🟡 低 | コメントアウトされたデバッグコード削除 |
| 🟡 低 | 大きなファイルの分割検討 |

---

## 結論

- **重大なDRY違反**: なし（修正済み）
- **デッドコード**: 明確なものはなし
- **到達不能コード**: 検出されず
- **改善候補**: TODO整理、マジックナンバー定数化
