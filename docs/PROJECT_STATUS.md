# Cm言語プロジェクト 現状と次のステップ

## 🎯 プロジェクト概要

**Cm（シーマイナー）** - MIRベースの多言語トランスコンパイラ

- **インタープリタ**: MIR直接実行（開発中）
- **トランスパイラ**: Rust/TypeScript/WASM出力（計画中）
- **型システム**: 明示的型宣言、ジェネリクス対応
- **オーバーロード**: 明示的な多重定義サポート

## ✅ 完了済み

### コンパイラ基盤
- [x] **Lexer**: 字句解析器
- [x] **Parser**: 構文解析器（基本構文）
- [x] **AST**: 抽象構文木
- [x] **HIR**: 高レベル中間表現
- [x] **MIR**: 中レベル中間表現（SSA形式）
- [x] **MIR最適化**: 基本的な最適化パス

### ドキュメント
- [x] 言語仕様（CANONICAL_SPEC.md）
- [x] アーキテクチャ設計
- [x] テストフレームワーク設計
- [x] トランスコンパイラ設計

### テスト基盤
- [x] 統一テストシステム（.cm + .expect）
- [x] マルチバックエンド対応テストランナー
- [x] リグレッション/統合テスト

## 🔧 現在の課題

### 1. 組み込み関数の未実装
```
問題: println等の組み込み関数が型チェッカーに登録されていない
影響: 基本的なプログラムも実行できない
```

### 2. MIRインタープリタの統合
```
問題: MIRインタープリタは実装済みだが、組み込み関数との接続が必要
影響: インタープリタモードが動作しない
```

### 3. Parser機能の不足
```
未実装:
- forループ
- ジェネリクス構文（<T: Trait>）
- impl ブロック
- overload修飾子
```

## 📋 次のステップ（優先順位順）

### Step 1: 組み込み関数の実装（必須）
```cpp
// src/frontend/types/type_checker.hpp に追加
void register_builtins() {
    // println: (any) -> void
    register_function("println", ...);
    // sqrt: (double) -> double
    register_function("sqrt", ...);
}
```

### Step 2: MIRインタープリタの完成
- [ ] 組み込み関数呼び出しの実装
- [ ] ユーザー定義関数のサポート
- [ ] エラーハンドリングの改善

### Step 3: Rustトランスパイラ（MVP）
```
目標: 基本的なプログラムをRustに変換
- 基本型のマッピング（int → i32）
- 関数変換
- println → println!マクロ
```

### Step 4: Parser拡張
- [ ] forループの実装
- [ ] ジェネリクス構文
- [ ] impl ブロック
- [ ] overload修飾子

## 🚀 開発ロードマップ

### Phase 1: インタープリタ完成（〜1週間）
- 組み込み関数実装
- 基本テストの動作確認
- ユーザー定義関数サポート

### Phase 2: Rustトランスパイラ（〜2週間）
- 基本型変換
- 関数変換
- 制御フロー変換
- 組み込み関数マッピング

### Phase 3: 言語機能拡張（〜1ヶ月）
- forループ
- 構造体
- ジェネリクス基本実装
- オーバーロード

### Phase 4: 他バックエンド（〜2ヶ月）
- TypeScriptトランスパイラ
- WASMバックエンド
- 最適化強化

## 📊 コンポーネント成熟度

| コンポーネント | 成熟度 | 備考 |
|--------------|--------|------|
| Lexer | ⭐⭐⭐⭐⭐ | 完成 |
| Parser | ⭐⭐⭐☆☆ | 基本構文のみ |
| Type Checker | ⭐⭐☆☆☆ | 組み込み関数未対応 |
| HIR | ⭐⭐⭐⭐☆ | 基本完成 |
| MIR | ⭐⭐⭐⭐☆ | 基本完成 |
| Interpreter | ⭐⭐☆☆☆ | 統合必要 |
| Rust Backend | ☆☆☆☆☆ | 未実装 |
| TS Backend | ☆☆☆☆☆ | 未実装 |
| WASM Backend | ☆☆☆☆☆ | 未実装 |

## 🎯 当面の目標

**最小動作プログラム（1週間以内）**:
```cm
int main() {
    println("Hello, World!");
    return 0;
}
```

これを：
1. インタープリタで実行 ✓
2. Rustにトランスパイル → rustcでコンパイル → 実行
3. テストスイートで自動検証

## 📝 メモ

- MIRベースアーキテクチャは良い設計判断
- テストフレームワークは十分整備済み
- ドキュメントは充実、実装が追いついていない
- 組み込み関数の実装が最優先事項

---

更新日: 2024年12月6日